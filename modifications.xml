<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
<license>
<!--
/**
 * Quote and Split (qas)
 *
 * @package qas
 * @author emanuele
 * @copyright 2012 emanuele, Simple Machines
 * @license http://www.simplemachines.org/about/smf/license.php BSD
 *
 * @version 0.1.0
 */
-->
</license>
	<name>Quote and Split</name>
	<id>emanuele:quote_and_split</id>
	<version>0.1.0</version>

	<file name="$sourcedir/Post.php">
		<operation>
			<search position="replace"><![CDATA[
	if (empty($board) && !$context['make_event'])
		fatal_lang_error('no_board', false);
]]></search>
			<add><![CDATA[
	if (empty($board) && !$context['make_event'] && !isset($_GET['qas']))
		fatal_lang_error('no_board', false);
	if (isset($_GET['qas']))
		qas_setBoardContext();
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		redirectexit('action=post;topic=' . $topic . '.0');

	// No need!
]]></search>
			<add><![CDATA[
		redirectexit('action=post;topic=' . $topic . '.0');

	$post_jump_to_select = isset($_POST['post_jump_to_select']) ? (int) $_POST['post_jump_to_select'] : 0;
	if (!empty($post_jump_to_select))
	{
		$current_board = $board;
		$board = $post_jump_to_select;
		loadBoard();
	}

	// No need!
]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
		createPost($msgOptions, $topicOptions, $posterOptions);

		if (isset($topicOptions['id']))
			$topic = $topicOptions['id'];
]]></search>
			<add><![CDATA[
		if (!empty($post_jump_to_select))
			$msgOptions['body'] .= qas_prepareNewPostNotice((int) $_POST['qas_original_topic'], (int) $_POST['qas_original_post']);

		createPost($msgOptions, $topicOptions, $posterOptions);

		if (isset($topicOptions['id']))
			$topic = $topicOptions['id'];

		if (!empty($post_jump_to_select))
			qas_updateOriginalPost($topic, $msgOptions, (int) $_POST['qas_original_post']);
]]></add>
		</operation>
	</file>

	<file name="$themedir/Display.template.php">
		<operation>
			<search position="before"><![CDATA[									<li class="quote_button"><a href="', $scripturl, '?action=post;quote=', $message['id'], ';topic=', $context['current_topic'], '.', $context['start'], ';last_msg=', $context['topic_last_message'], '" onclick="return oQuickReply.quote(', $message['id'], ');">', $txt['quote'], '</a></li>]]></search>
			<add><![CDATA[
									<li class="quote_button"><a href="', $scripturl, '?action=post;quote=', $message['id'], ';qas=', $context['current_topic'], '">', $txt['quote'], '</a></li>']]></add>
		</operation>
	</file>

	<file name="$themedir/Post.template.php">
		<operation>
			<search position="replace"><![CDATA[
	echo '
							</select>
							<img src="', $context['icon_url'], '" name="icons" hspace="15" alt="" />
						</dd>
					</dl>
					<hr class="clear" />';
]]></search>
			<add><![CDATA[
	echo '
							</select>
							<img src="', $context['icon_url'], '" name="icons" hspace="15" alt="" />
						</dd>', !empty($context['qas_original_topic']) && !empty($context['qas_original_post']) ? '
						<dt>
							<label class="smalltext" for="display_jump_to">' . $context['jump_to']['label'] . ':</label>
						</dt>
						<dd id="post_jump_to">&nbsp;</dd>
						<input type="hidden" name="qas_original_topic" value="' . $context['qas_original_topic'] . '" />
						<input type="hidden" name="qas_original_post" value="' . $context['qas_original_post'] . '" />' : '', '
					</dl>
					<hr class="clear" />';
]]></add>
		</operation>
	</file>

</modification>